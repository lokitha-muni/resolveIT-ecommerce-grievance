<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Login - ResolveIT</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-form-box">
            <div class="auth-logo">
                <div class="logo-icon">R</div>
                <h1>ResolveIT</h1>
            </div>
            <h2 id="portalTitle">Staff Portal</h2>
            <p class="subtitle">Access your work dashboard</p>
            
            <!-- Staff/Admin Toggle -->
            <div class="admin-toggle">
                <label class="toggle-label">
                    <input type="checkbox" id="staffToggle">
                    <span class="toggle-slider"></span>
                    <span class="toggle-text" id="toggleText">Admin Login</span>
                </label>
            </div>
            
            <form id="staffLoginForm">
                <div class="input-group">
                    <label>Staff ID / Email</label>
                    <input type="email" id="staffEmail" placeholder="Enter your staff ID or email" required>
                </div>
                
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="staffPassword" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="submit-btn">Sign In</button>
            </form>
            
            <div class="switch-form">
                <p>Customer? <a href="login.html">Login here</a></p>
            </div>
        </div>
    </div>
    
    <script src="js/security.js"></script>
    <script>
        const staffToggle = document.getElementById('staffToggle');
        const staffLoginForm = document.getElementById('staffLoginForm');
        const subtitle = document.querySelector('.subtitle');
        const portalTitle = document.getElementById('portalTitle');
        const toggleText = document.getElementById('toggleText');
        
        staffToggle.addEventListener('change', function() {
            if (this.checked) {
                portalTitle.textContent = 'Admin Portal';
                subtitle.textContent = 'Admin access portal';
                toggleText.textContent = 'Staff Login';
            } else {
                portalTitle.textContent = 'Staff Portal';
                subtitle.textContent = 'Access your work dashboard';
                toggleText.textContent = 'Admin Login';
            }
        });
        
        staffLoginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = securityManager.sanitizeInput(document.getElementById('staffEmail').value);
            const password = document.getElementById('staffPassword').value;
            
            if (!securityManager.validateEmail(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:9090/api/auth/staff/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.status === 'otp_required') {
                    // Redirect to 2FA page
                    window.location.href = `staff-2fa.html?email=${encodeURIComponent(email)}`;
                } else if (data.status === 'success') {
                    // Direct login (fallback)
                    securityManager.setToken(data.token);
                    localStorage.setItem('staff', JSON.stringify({
                        email: email,
                        role: data.role
                    }));
                    
                    if (data.role === 'ADMIN') {
                        window.location.href = 'admin-dashboard.html';
                    } else {
                        window.location.href = 'staff-dashboard.html';
                    }
                } else {
                    alert(data.message || 'Invalid credentials');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        });
    </script>
</body>
</html>