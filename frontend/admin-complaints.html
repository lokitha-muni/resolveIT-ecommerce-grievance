<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage All Complaints â€“ ResolveIT Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #F3F4F1;
            --bg-secondary: #EEF0EC;
            --bg-card: #FAFAF8;
            --accent-primary: #4E7C73;
            --accent-secondary: #7A9E9F;
            --text-primary: #2F2F2F;
            --text-secondary: #5F6368;
            --text-muted: #7A7D81;
            --border: #E3E5E1;
            --shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-light: 1px solid rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 32px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 56px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,250,252,0.8) 100%);
            backdrop-filter: blur(10px);
            padding: 36px 44px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .header:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        .header-left h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
        }

        .header-left p {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
            box-shadow: 0 6px 20px rgba(15, 118, 110, 0.4);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: var(--border-light);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow);
        }

        .user-menu:hover {
            box-shadow: var(--shadow-hover);
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: var(--accent-primary);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 28px;
            margin-bottom: 64px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0f766e 0%, #14b8a6 50%, #2dd4bf 100%);
        }

        .stat-card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.06);
            transform: translateY(-4px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f766e 0%, #14b8a6 100%);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
            font-size: 22px;
            color: white;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 16px 0 8px 0;
            line-height: 1;
        }

        .stat-change {
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
        }

        /* Filters */
        .filters-section {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 32px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 32px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(78, 124, 115, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Table */
        .card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,252,0.9) 100%);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            overflow: hidden;
            margin-bottom: 32px;
        }

        .card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        .card-header {
            padding: 32px 40px 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-content {
            padding: 32px 40px 40px 40px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: center;
            padding: 16px 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, #F8F9F7, var(--bg-secondary));
            border-bottom: 1px solid var(--border);
        }

        td {
            text-align: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            color: var(--text-secondary);
        }

        tr:hover {
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.03) 0%, rgba(20, 184, 166, 0.02) 100%);
            transform: scale(1.001);
            transition: all 0.2s ease;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
        }

        .status-pending {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
            color: #92400e;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .status-progress {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);
            color: #1d4ed8;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .status-in-progress {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);
            color: #1d4ed8;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .status-closed {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.15) 0%, rgba(75, 85, 99, 0.1) 100%);
            color: #374151;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }

        .status-resolved {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(22, 163, 74, 0.1) 100%);
            color: #15803d;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .priority {
            display: inline-flex;
            align-items: center;
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            backdrop-filter: blur(10px);
        }

        .priority.high {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%);
            color: #DC2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .priority.medium {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(217, 119, 6, 0.1) 100%);
            color: #D97706;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .priority.low {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(5, 150, 105, 0.1) 100%);
            color: #059669;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        /* Issue Type Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tag.orange {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(234, 88, 12, 0.1) 100%);
            color: #ea580c;
            border: 1px solid rgba(251, 146, 60, 0.2);
        }

        .tag.blue {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .tag.yellow {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
            color: #f59e0b;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .tag.red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(220, 38, 38, 0.1) 100%);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .tag.purple {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.15) 0%, rgba(126, 34, 206, 0.1) 100%);
            color: #7e22ce;
            border: 1px solid rgba(147, 51, 234, 0.2);
        }

        .tag.gray {
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.15) 0%, rgba(75, 85, 99, 0.1) 100%);
            color: #4b5563;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }

        /* SLA Status */
        .sla-ok {
            color: #059669;
            font-weight: 600;
        }

        .sla-warning {
            color: #d97706;
            font-weight: 600;
        }

        .sla-critical {
            color: #dc2626;
            font-weight: 600;
        }

        /* Special Row Styles */
        .urgent-row {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.02) 0%, rgba(220, 38, 38, 0.01) 100%) !important;
            border-left: 3px solid #dc2626;
        }

        .unassigned-row {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.02) 0%, rgba(245, 158, 11, 0.01) 100%) !important;
            border-left: 3px solid #f59e0b;
        }

        /* View Link */
        .view-link {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.05) 0%, rgba(20, 184, 166, 0.03) 100%);
            border: 1px solid rgba(15, 118, 110, 0.1);
        }

        .view-link:hover {
            background: linear-gradient(135deg, rgba(15, 118, 110, 0.1) 0%, rgba(20, 184, 166, 0.08) 100%);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .action-link {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .action-link:hover {
            background: var(--bg-secondary);
            color: #3F6B62;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 20px 16px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
                padding: 20px 24px;
            }

            .header-right {
                width: 100%;
                justify-content: flex-end;
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .stat-card {
                padding: 20px;
            }

            .card-header, .card-content {
                padding: 20px 24px;
            }

            .card-header {
                padding-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>All Complaints</h1>
                <p>Comprehensive complaint management and oversight</p>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i data-lucide="refresh-cw"></i> Refresh
                </button>
                <a href="admin-dashboard.html" class="btn btn-secondary">
                    <i data-lucide="arrow-left"></i> Dashboard
                </a>
                <div class="user-menu" onclick="showUserMenu()">
                    <div class="user-avatar">A</div>
                    <span>Admin</span>
                </div>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Total Complaints</div>
                    <div class="stat-icon"><i data-lucide="clipboard-list"></i></div>
                </div>
                <div class="stat-value" id="totalComplaints">0</div>
                <div class="stat-change">All system complaints</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Unassigned</div>
                    <div class="stat-icon"><i data-lucide="user-x"></i></div>
                </div>
                <div class="stat-value" id="unassignedComplaints">0</div>
                <div class="stat-change">Need agent assignment</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Active Agents</div>
                    <div class="stat-icon"><i data-lucide="users"></i></div>
                </div>
                <div class="stat-value" id="activeAgents">0</div>
                <div class="stat-change">Currently working</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Avg Resolution</div>
                    <div class="stat-icon"><i data-lucide="clock"></i></div>
                </div>
                <div class="stat-value" id="avgResolution">0h</div>
                <div class="stat-change">Time to resolve</div>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Status Filter</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="all">All Status</option>
                        <option value="PENDING">Pending</option>
                        <option value="IN_PROGRESS">In Progress</option>
                        <option value="RESOLVED">Resolved</option>
                        <option value="FORCE_CLOSED">Force Closed</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Priority Filter</label>
                    <select class="filter-select" id="priorityFilter">
                        <option value="all">All Priority</option>
                        <option value="High">High Priority</option>
                        <option value="Medium">Medium Priority</option>
                        <option value="Low">Low Priority</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Agent Filter</label>
                    <select class="filter-select" id="agentFilter">
                        <option value="all">All Agents</option>
                        <option value="unassigned">Unassigned</option>
                    </select>
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-secondary" onclick="clearFilters()">
                    <i data-lucide="x"></i> Clear
                </button>
                <button class="btn btn-primary" onclick="applyFilters()">
                    <i data-lucide="filter"></i> Apply Filters
                </button>
                <button class="btn btn-secondary" onclick="bulkExport()">
                    <i data-lucide="download"></i> Export
                </button>
            </div>
        </div>

        <!-- Complaints Table -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">All System Complaints</h2>
                <div class="filter-actions">
                    <button class="btn btn-secondary" onclick="bulkAssign()">
                        <i data-lucide="user-plus"></i> Bulk Assign
                    </button>
                    <button class="btn btn-secondary" onclick="generateReport()">
                        <i data-lucide="file-text"></i> Report
                    </button>
                </div>
            </div>
            <div class="card-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllAdmin" onchange="toggleSelectAllAdmin()"></th>
                                <th>ID</th>
                                <th>Customer</th>
                                <th>Order ID</th>
                                <th>Issue Type</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Assigned Agent</th>
                                <th>Created</th>
                                <th>SLA Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="complaintsTableBody">
                            <tr>
                                <td colspan="11">
                                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                                        <i data-lucide="loader" style="font-size: 48px; margin-bottom: 16px;"></i>
                                        <p>Loading complaints...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allComplaints = [];
        let allStaff = [];
        let filteredComplaints = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminData();
            // Initialize Lucide icons
            lucide.createIcons();
        });
        
        async function loadAdminData() {
            try {
                // Load complaints and stats
                const [complaintsResponse, statsResponse, staffResponse] = await Promise.all([
                    fetch(getApiUrl('/api/admin/complaints')),
                    fetch(getApiUrl('/api/admin/stats')),
                    fetch(getApiUrl('/api/admin/staff'))
                ]);
                
                if (complaintsResponse.ok) {
                    allComplaints = await complaintsResponse.json();
                    filteredComplaints = [...allComplaints];
                    renderComplaints();
                }
                
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateStats(stats);
                }
                
                if (staffResponse.ok) {
                    allStaff = await staffResponse.json();
                    populateAgentFilter();
                }
                
                calculateAnalytics();
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }
        
        function updateStats(stats) {
            document.getElementById('totalComplaints').textContent = stats.totalComplaints || 0;
            document.getElementById('unassignedComplaints').textContent = stats.unassigned || 0;
            document.getElementById('activeAgents').textContent = stats.activeAgents || 0;
            document.getElementById('avgResolution').textContent = stats.avgResolution || '0h';
        }
        
        function populateAgentFilter() {
            const agentFilter = document.getElementById('agentFilter');
            // Clear existing options except first two
            while (agentFilter.children.length > 2) {
                agentFilter.removeChild(agentFilter.lastChild);
            }
            
            allStaff.forEach(staff => {
                const option = document.createElement('option');
                option.value = staff.name;
                option.textContent = staff.name;
                agentFilter.appendChild(option);
            });
        }
        
        function renderComplaints() {
            const tbody = document.getElementById('complaintsTableBody');
            tbody.innerHTML = '';
            
            if (filteredComplaints.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11">
                            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                                <i data-lucide="clipboard-list" style="font-size: 48px; margin-bottom: 16px;"></i>
                                <p>No complaints found matching the current filters</p>
                            </div>
                        </td>
                    </tr>
                `;
                // Re-initialize icons for the new content
                lucide.createIcons();
                return;
            }
            
            filteredComplaints.forEach(complaint => {
                const row = createComplaintRow(complaint);
                tbody.appendChild(row);
            });
            
            // Re-attach event listeners
            document.querySelectorAll('.admin-row-select').forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCount);
            });
            
            // Re-initialize icons for the new content
            lucide.createIcons();
        }
        
        function createComplaintRow(complaint) {
            const row = document.createElement('tr');
            row.setAttribute('data-id', complaint.complaintId);
            
            // Add special classes based on status/priority
            if (complaint.priority === 'High' && complaint.status === 'PENDING') {
                row.classList.add('urgent-row');
            }
            if (!complaint.assignedAgent) {
                row.classList.add('unassigned-row');
            }
            
            const customerName = extractCustomerName(complaint.userEmail);
            const timeAgo = getTimeAgo(complaint.createdAt);
            const slaStatus = getSLAStatus(complaint);
            
            row.innerHTML = `
                <td><input type="checkbox" class="admin-row-select"></td>
                <td><strong>${complaint.complaintId}</strong></td>
                <td>${customerName}</td>
                <td>${complaint.orderId}</td>
                <td><span class="tag ${getIssueTypeClass(complaint.issueType)}">${complaint.issueType}</span></td>
                <td><span class="priority ${complaint.priority.toLowerCase()}">${complaint.priority}</span></td>
                <td><span class="status-badge ${getStatusClass(complaint.status)}">${formatStatus(complaint.status)}</span></td>
                <td>${complaint.assignedAgent || '<em>Not Assigned</em>'}</td>
                <td>${timeAgo}</td>
                <td><span class="${slaStatus.class}">${slaStatus.text}</span></td>
                <td><a href="admin-complaint-details.html?id=${complaint.complaintId}" class="view-link">View Details</a></td>
            `;
            
            return row;
        }
        
        function extractCustomerName(email) {
            if (email === 'test@gmail.com') return 'Test User';
            const name = email.split('@')[0].replace(/\./g, ' ');
            return name.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }
        
        function getTimeAgo(createdAt) {
            if (!createdAt) return 'Recently';
            const now = new Date();
            const created = new Date(createdAt);
            const diffMs = now - created;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            if (diffHours > 0) return `${diffHours}h ago`;
            return 'Recently';
        }
        
        function getSLAStatus(complaint) {
            if (complaint.status === 'RESOLVED' || complaint.status === 'FORCE_CLOSED') {
                return { class: 'sla-ok', text: 'Completed' };
            }
            if (!complaint.assignedAgent) {
                return { class: 'sla-warning', text: 'Needs Assignment' };
            }
            if (complaint.priority === 'High') {
                return { class: 'sla-critical', text: 'Critical' };
            }
            return { class: 'sla-ok', text: 'On Track' };
        }
        
        function getIssueTypeClass(issueType) {
            const typeMap = {
                'Wrong Product': 'orange',
                'Late Delivery': 'blue',
                'Damaged Product': 'orange',
                'Missing Item': 'yellow',
                'Quality Issue': 'red',
                'Billing Issue': 'purple'
            };
            return typeMap[issueType] || 'gray';
        }
        
        function getStatusClass(status) {
            const statusMap = {
                'PENDING': 'pending',
                'IN_PROGRESS': 'progress',
                'RESOLVED': 'resolved',
                'FORCE_CLOSED': 'closed'
            };
            return statusMap[status] || 'pending';
        }
        
        function formatStatus(status) {
            const statusMap = {
                'PENDING': 'Pending',
                'IN_PROGRESS': 'In Progress',
                'RESOLVED': 'Resolved',
                'FORCE_CLOSED': 'Force Closed'
            };
            return statusMap[status] || status;
        }
        
        function clearFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('priorityFilter').value = 'all';
            document.getElementById('agentFilter').value = 'all';
            
            filteredComplaints = [...allComplaints];
            renderComplaints();
        }
        
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const agentFilter = document.getElementById('agentFilter').value;
            
            filteredComplaints = allComplaints.filter(complaint => {
                const statusMatch = statusFilter === 'all' || complaint.status === statusFilter;
                const priorityMatch = priorityFilter === 'all' || complaint.priority === priorityFilter;
                const agentMatch = agentFilter === 'all' || 
                    (agentFilter === 'unassigned' && !complaint.assignedAgent) ||
                    complaint.assignedAgent === agentFilter;
                
                return statusMatch && priorityMatch && agentMatch;
            });
            
            renderComplaints();
        }
        
        function calculateAnalytics() {
            if (allComplaints.length === 0) return;
            
            const resolved = allComplaints.filter(c => c.status === 'RESOLVED').length;
            const resolutionRate = Math.round((resolved / allComplaints.length) * 100);
            
            const avgWorkload = allStaff.length > 0 ? 
                (allStaff.reduce((sum, staff) => sum + (staff.workload || 0), 0) / allStaff.length).toFixed(1) : 0;
            
            document.getElementById('resolutionRate').textContent = resolutionRate + '%';
            document.getElementById('responseTime').textContent = '1.2h';
            document.getElementById('agentWorkload').textContent = avgWorkload;
        }
        
        function toggleSelectAllAdmin() {
            const selectAll = document.getElementById('selectAllAdmin');
            const checkboxes = document.querySelectorAll('.admin-row-select');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selected = document.querySelectorAll('.admin-row-select:checked').length;
            console.log(`${selected} complaints selected`);
        }

        function bulkAssign() {
            const selected = document.querySelectorAll('.admin-row-select:checked');
            if (selected.length === 0) {
                alert('Please select complaints to assign first');
                return;
            }
            
            const agent = prompt('Enter agent name to assign selected complaints:');
            if (agent && confirm(`Assign ${selected.length} complaints to ${agent}?`)) {
                console.log(`Assigning ${selected.length} complaints to ${agent}`);
                loadAdminData();
            }
        }

        function bulkExport() {
            if (confirm('Export all complaints data as CSV?')) {
                try {
                    const csvData = generateCSV(allComplaints);
                    const blob = new Blob([csvData], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'admin_complaints_export.csv';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                } catch (error) {
                    console.error('Export error:', error);
                    alert('Export failed. Please try again.');
                }
            }
        }
        
        function generateCSV(complaints) {
            let csv = 'Complaint ID,Customer,Order ID,Issue Type,Priority,Status,Assigned Agent,Created\n';
            complaints.forEach(complaint => {
                csv += `"${complaint.complaintId}","${extractCustomerName(complaint.userEmail)}","${complaint.orderId}","${complaint.issueType}","${complaint.priority}","${complaint.status}","${complaint.assignedAgent || 'Unassigned'}","${getTimeAgo(complaint.createdAt)}"\n`;
            });
            return csv;
        }

        function generateReport() {
            if (confirm('Generate comprehensive system report?')) {
                const reportData = {
                    totalComplaints: allComplaints.length,
                    pendingComplaints: allComplaints.filter(c => c.status === 'PENDING').length,
                    inProgressComplaints: allComplaints.filter(c => c.status === 'IN_PROGRESS').length,
                    resolvedComplaints: allComplaints.filter(c => c.status === 'RESOLVED').length,
                    unassignedComplaints: allComplaints.filter(c => !c.assignedAgent).length,
                    highPriorityComplaints: allComplaints.filter(c => c.priority === 'High').length,
                    activeAgents: allStaff.length,
                    generatedAt: new Date().toISOString()
                };
                
                const reportText = `RESOLVEIT SYSTEM REPORT\n\nGenerated: ${new Date().toLocaleString()}\n\nSUMMARY:\nTotal Complaints: ${reportData.totalComplaints}\nPending: ${reportData.pendingComplaints}\nIn Progress: ${reportData.inProgressComplaints}\nResolved: ${reportData.resolvedComplaints}\nUnassigned: ${reportData.unassignedComplaints}\nHigh Priority: ${reportData.highPriorityComplaints}\nActive Agents: ${reportData.activeAgents}\n\nResolution Rate: ${Math.round((reportData.resolvedComplaints / reportData.totalComplaints) * 100)}%`;
                
                const blob = new Blob([reportText], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ResolveIT_Report_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }
        }

        function refreshData() {
            loadAdminData();
        }

        function showUserMenu() {
            if (confirm('Do you want to logout?')) {
                logout();
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = 'index.html';
            }
        }

        function addComplaint() {
            if (confirm('Open new complaint form?')) {
                window.location.href = 'submit-complaint.html';
            }
        }
    </script>
    <script src="js/config.js"></script>
</body>
</html>
